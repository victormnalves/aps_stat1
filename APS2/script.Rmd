---
title: "script"
author: "Victor Alves"
date: "28/04/2021"
output: pdf_document
---

# Ambientação

Carregando os pacotes
```{r}
library(tidyverse)
library(janitor)
library(gridExtra)
library(DescTools)
library(viridis)
library(RColorBrewer)
theme_set(theme_minimal())
```

Carregando todos os dados
```{r}
original_data <- readxl::read_excel("C:/Users/Victor/OneDrive - Insper - Institudo de Ensino e Pesquisa/Estudos/Programação e Data Science/Estat/aps_stat1/APS2/aps2.xlsx") %>%
  clean_names()
```

Filtrando os dados apenas para o país de interesse
```{r}
dados <- original_data %>% filter(country == 'United States')
```

# Trabalhando com medidas

Medidas de inflação por país
```{r}
medidas_pi_usa <- dados %>%
  group_by(code) %>% 
  summarise(media = round(mean(inflation),2),
            mediana = median(inflation),
            desvio = round(sd(inflation),2),
            cv = round(sd(inflation)/mean(inflation)*100,2),
            meanad = MeanAD(inflation),
            n = n(),
            IQ = IQR(inflation),
            max = max(inflation),
            min = min(inflation),
            amp = max - min,
            li = quantile(inflation, .25) - 1.5*IQR(inflation),
            ls = quantile(inflation, .75) + 1.5*IQR(inflation),
            ass_A = quantile(inflation, .5) - quantile(inflation, .25),
            ass_B = quantile(inflation, .75) - quantile(inflation, .5))
```

Medidas de desemprego por ano
```{r}
medidas_u_usa <- dados %>%
  group_by(code) %>% 
  summarise(media = round(mean(unemployment),2),
            mediana = median(unemployment),
            desvio = round(sd(unemployment),2),
            cv = round(sd(unemployment)/mean(unemployment)*100,2),
            meanad = MeanAD(unemployment),
            n = n(),
            IQ = IQR(unemployment),
            max = max(unemployment),
            min = min(unemployment),
            amp = max - min,
            li = quantile(unemployment, .25) - 1.5*IQR(unemployment),
            ls = quantile(unemployment, .75) + 1.5*IQR(unemployment),
            ass_A = quantile(unemployment, .5) - quantile(unemployment, .25),
            ass_B = quantile(unemployment, .75) - quantile(unemployment, .5))
```

Unindo as tabelas de medidas 
```{r}
medidas <- as.tibble(rbind(medidas_pi_usa, medidas_u_usa))
medidas <- medidas %>% select(-c(code))
row.names(medidas) <- c('Inflação','Desemprego')
```
# Medidas antes e depois de 1991

Inflação antes de 91

```{r}
medidas_pi_usa_a91 <- dados %>% 
  group_by(code) %>% 
  filter(year <= 1991) %>%
  summarise(media = round(mean(inflation),2),
            mediana = median(inflation),
            desvio = round(sd(inflation),2),
            cv = round(sd(inflation)/mean(inflation)*100,2),
            meanad = MeanAD(inflation),
            n = n(),
            IQ = IQR(inflation),
            max = max(inflation),
            min = min(inflation),
            amp = max - min,
            li = quantile(inflation, .25) - 1.5*IQR(inflation),
            ls = quantile(inflation, .75) + 1.5*IQR(inflation),
            ass_A = quantile(inflation, .5) - quantile(inflation, .25),
            ass_B = quantile(inflation, .75) - quantile(inflation, .5))
```

```{r}
medidas_u_usa_a91 <- dados %>%
  group_by(code) %>% 
  filter(year <= 1991) %>%
  summarise(media = round(mean(unemployment),2),
            mediana = median(unemployment),
            desvio = round(sd(unemployment),2),
            cv = round(sd(unemployment)/mean(unemployment)*100,2),
            meanad = MeanAD(unemployment),
            n = n(),
            IQ = IQR(unemployment),
            max = max(unemployment),
            min = min(unemployment),
            amp = max - min,
            li = quantile(unemployment, .25) - 1.5*IQR(unemployment),
            ls = quantile(unemployment, .75) + 1.5*IQR(unemployment),
            ass_A = quantile(unemployment, .5) - quantile(unemployment, .25),
            ass_B = quantile(unemployment, .75) - quantile(unemployment, .5))

```


```{r}
medidas_a91 <- as.tibble(rbind(medidas_pi_usa_a91, medidas_u_usa_a91))
medidas_a91 <- medidas_a91 %>% select(-c(code))
row.names(medidas_a91) <- c('Inflação','Desemprego')

```


Medidas depois de 1991

```{r}
medidas_pi_usa_d91 <- dados %>% 
  group_by(code) %>% 
  filter(year >= 1991) %>%
  summarise(media = round(mean(inflation),2),
            mediana = median(inflation),
            desvio = round(sd(inflation),2),
            cv = round(sd(inflation)/mean(inflation)*100,2),
            meanad = MeanAD(inflation),
            n = n(),
            IQ = IQR(inflation),
            max = max(inflation),
            min = min(inflation),
            amp = max - min,
            li = quantile(inflation, .25) - 1.5*IQR(inflation),
            ls = quantile(inflation, .75) + 1.5*IQR(inflation),
            ass_A = quantile(inflation, .5) - quantile(inflation, .25),
            ass_B = quantile(inflation, .75) - quantile(inflation, .5))
```

```{r}
medidas_u_usa_d1991 <- dados %>%
  group_by(code) %>% 
  filter(year >= 1991) %>%
  summarise(media = round(mean(unemployment),2),
            mediana = median(unemployment),
            desvio = round(sd(unemployment),2),
            cv = round(sd(unemployment)/mean(unemployment)*100,2),
            meanad = MeanAD(unemployment),
            n = n(),
            IQ = IQR(unemployment),
            max = max(unemployment),
            min = min(unemployment),
            amp = max - min,
            li = quantile(unemployment, .25) - 1.5*IQR(unemployment),
            ls = quantile(unemployment, .75) + 1.5*IQR(unemployment),
            ass_A = quantile(unemployment, .5) - quantile(unemployment, .25),
            ass_B = quantile(unemployment, .75) - quantile(unemployment, .5))

```


```{r}
medidas_d91 <- as.tibble(rbind(medidas_pi_usa_d91, medidas_u_usa_d1991))
medidas_d91 <- medidas_d91 %>% select(-c(code))
row.names(medidas_d91) <- c('Inflação','Desemprego')

```



# Plots

## Evolução linear de pi ao das decadas dos anos

```{r}
ev_pi_u_60 <- dados %>% filter(year %in% 1960:1969) %>% ggplot() + 
  geom_point(aes(year,inflation, colour = 'inflation')) + 
  geom_point(aes(year,unemployment, colour = 'unemployment')) +
  ggtitle('Inflação e desemprego entre 1960 e 1969') + 
  xlab('Ano') + ylab('Taxa') + ylim(-1,14) + 
  scale_colour_viridis(discrete = T,name = 'Variável', labels = c('Inflação', 'Desemprego'))

```

```{r}
ev_pi_u_70 <- dados %>% filter(year %in% 1970:1979) %>% ggplot() + 
  geom_point(aes(year,inflation, colour = 'inflation')) + 
  geom_point(aes(year,unemployment, colour = 'unemployment')) +
  ggtitle('Inflação e desemprego entre 1970 e 1979') + 
  xlab('Ano') + ylab('Taxa') + ylim(-1,14) + 
  scale_colour_viridis(discrete = T,name = 'Variável', labels = c('Inflação', 'Desemprego'))
```

```{r}
ev_pi_u_80 <- dados %>% filter(year %in% 1980:1989) %>% ggplot() + 
  geom_point(aes(year,inflation, colour = 'inflation')) + 
  geom_point(aes(year,unemployment, colour = 'unemployment')) +
  ggtitle('Inflação e desemprego entre 1980 e 1989') + 
  xlab('Ano') + ylab('Taxa') + ylim(-1,14) + 
  scale_colour_viridis(discrete = T,name = 'Variável', labels = c('Inflação', 'Desemprego'))
```

```{r}
ev_pi_u_90 <- dados %>% filter(year %in% 1990:1999) %>% ggplot() + 
  geom_point(aes(year,inflation, colour = 'inflation')) + 
  geom_point(aes(year,unemployment, colour = 'unemployment')) +
  ggtitle('Inflação e desemprego entre 1990 e 1999') + 
  xlab('Ano') + ylab('Taxa') + ylim(-1,14) + 
  scale_colour_viridis(discrete = T,name = 'Variável', labels = c('Inflação', 'Desemprego'))
```

```{r}
ev_pi_u_00 <- dados %>% filter(year %in% 2000:2009) %>% ggplot() + 
  geom_point(aes(year,inflation, colour = 'inflation')) + 
  geom_point(aes(year,unemployment, colour = 'unemployment')) +
  ggtitle('Inflação e desemprego entre 2000 e 2009') + 
  xlab('Ano') + ylab('Taxa') + ylim(-1,14) + 
  scale_colour_viridis(discrete = T,name = 'Variável', labels = c('Inflação', 'Desemprego'))
```

```{r}
ev_pi_u_10 <- dados %>% filter(year %in% 2010:2019) %>% ggplot() + 
  geom_point(aes(year,inflation, colour = 'inflation')) + 
  geom_point(aes(year,unemployment, colour = 'unemployment')) +
  ggtitle('Inflação e desemprego entre 2010 e 2019') + 
  xlab('Ano') + ylab('Taxa') + ylim(-1,14) + 
  scale_colour_viridis(discrete = T,name = 'Variável', labels = c('Inflação', 'Desemprego'))
```
Unindo os plots de evolução
```{r}
grid.arrange(arrangeGrob(ev_pi_u_60, ev_pi_u_70), 
             top = 'Evolução da inflação e desemprego ao longo das décadas de 60 e 70')

grid.arrange(arrangeGrob(ev_pi_u_80, ev_pi_u_90), 
             top = 'Evolução da inflação e desemprego ao longo das décadas de 80 e 90')

grid.arrange(arrangeGrob(ev_pi_u_00, ev_pi_u_10), 
             top = 'Evolução da inflação e desemprego ao longo das décadas de 00 e 10')

```

```{r}
grid.arrange(arrangeGrob(ev_pi_u_90, ev_pi_u_00, ev_pi_u_10), 
             top = 'Evolução da inflação e desemprego ao longo das décadas de 90 a 10')
```
## Plots de distribuição

Distribuição densidade do desemprego e da inflação 
```{r}
dados %>% ggplot() + 
  geom_density(aes(unemployment, stat(density), fill = 'unemplyment'), alpha = 0.5) +
  geom_density(aes(inflation, stat(density), fill = 'inflation'), alpha = 0.5) +
  xlab('Taxa') + ylab('Densidade') + xlim(0,15) +
  ggtitle('Distribuição da taxa de desemprego e inflação') +
  scale_fill_viridis(discrete = T, name = 'Variável', 
                     labels = c('Inflação','Desemprego')) 
```

Distribuição boxplot do desemprego
```{r}
box_u <- dados %>% ggplot() + 
  geom_boxplot(aes(y = unemployment, fill = 'unemplyment'), alpha = 0.5) +
  xlab('Concentração') + ylab('Taxa') + ylim(0,15) +
  ggtitle('Desemprego') +
  scale_fill_viridis(discrete = T, guide = F) 

```

Distribuição boxplot da inflação

```{r}
box_pi <- dados %>% ggplot() + 
  geom_boxplot(aes(y = inflation, fill = 'inflation'), alpha = 0.5) +
  xlab('Concentração') + ylab('Taxa') + ylim(0,15) +
  ggtitle('Inflação') +
  scale_fill_viridis(discrete = T, guide = F) + 
  theme(axis.title.y=element_blank(),
        axis.ticks.y=element_blank(),
        axis.text.y=element_blank())
```

```{r}
grid.arrange(arrangeGrob(box_u, box_pi, ncol = 2), 
             top = 'Distribuição da taxa de desemprego e inflação')
```
Correlação entre variáveis
```{r}
dados %>% ggplot(aes(unemployment, inflation, label = year)) + 
  geom_point(aes(colour = year)) + 
  geom_text(aes(label = year),hjust = 0, vjust = 0, size = 3) +
  geom_smooth(method = 'lm') +
  xlab('Desemprego') + ylab('Inflação') + ggtitle('Relação entre inflação e desemprego') + 
  scale_colour_viridis(discrete = T, guide = F)
```

